<!doctype html>
<html lang="en">

<head>
  <title>Petocracy: Registration</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Baloo+2:400,500,600,700,800&amp;subset=latin">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
  <link rel="stylesheet" href="./css/bulma.min.css">
  <link rel="stylesheet" href="./css/testimonials.css">
  <link rel="shortcut icon" type="image/jpg" href="./p2-images/logo/petocracylogo-logomark.png" />
  <link rel="icon" href="favicon.ico">
</head>

<body>
  <div class="container is-fluid">
    <nav class="navbar">
      <div class="container">
        <div class="navbar-brand"><a class="navbar-item" href="/"><img
              src="./p2-images/logo/petocracylogo-horizonal.png"></a><a class="navbar-burger" role="button"
            aria-label="menu" aria-expanded="false"><span aria-hidden="true"></span><span
              aria-hidden="true"></span><span aria-hidden="true"></span></a></div>
        <div class="navbar-menu">
          <div class="navbar-start">
            <a class="navbar-item" style="color:black;" href="/aboutus">About Us</a><a class="navbar-item"
              style="color:black;" href="/all-pets/services">Volunteer</a><a class="navbar-item" style="color:black;"
              href="/all-pets">Pets</a>
            <a class="navbar-item" style="color:black;" href="/aboutus#contactus">Contact Us</a>
          </div>
          <div class="navbar-end">
            <div class="navbar-item">
              <div class="buttons"><a class="control button button-ikr is-primary" href="/logout">Log Out</a></div>
            </div>
          </div>
        </div>
      </div>
    </nav>
    <!-- end of nav -->



    <section class="hero">
      <div class="hero-body">

        <div class="container has-text-centered">
          <div class="level">
            <div class="level-item">
              <figure class="image is-64x64"><img src="./p2-images/logo/petocracylogo-logomark.png" alt="logo"></figure>
            </div>
          </div>

          <h1 class="title">Registration Form</h1>
        </div>
      </div>

      <div class="container">
        <div class="row">
          <div class="col-md-6 col-md-offset-3">

            <h4 class="title is-4">Register below</h2>
              <form class="signup">

                <div id="registrationDiv">

                  <div class="field is-grouped">
                    <div class="control is-expanded">
                      <div class="form-group">
                        <label class="label" for="exampleInputEmail1">First Name</label>
                        <input type="input" class="input form-control" id="first-name" placeholder="First Name"
                          required>
                      </div>
                    </div>


                    <!-- <div class="field is-grouped"> -->
                    <div class="control is-expanded">
                      <div class="form-group">
                        <label class="label" for="exampleInputEmail1">Last Name</label>
                        <input type="input" class="input form-control" id="last-name" placeholder="Last Name" required>
                      </div>
                    </div>
                  </div>

                  <div class="field">
                    <div class="form-group">
                      <label class="label" for="exampleInputEmail1">Address</label>
                      <input type="input" class="input form-control" id="street" placeholder="Street" required>
                    </div>
                  </div>

                  <div class="field">
                    <div class="form-group">
                      <label class="label" for="exampleInputEmail1">Address2</label>
                      <input type="input" class="input form-control" id="street2" placeholder="Street2" required>
                    </div>
                  </div>
                  <div class="field">

                    <div class="field is-grouped">
                      <div class="control is-expanded">
                        <div class="form-group">
                          <label class="label" for="exampleInputEmail1">City</label>
                          <input type="input" class="input form-control" id="city" placeholder="City" required>
                        </div>
                      </div>

                      <!-- <div class="field is-grouped"> -->
                      <div class="control is-expanded">
                        <div class="form-group">
                          <label class="label" for="exampleInputEmail1">State</label>
                          <input type="input" class="input form-control" id="state" placeholder="State" maxlength="2"
                            size="2" required>
                        </div>
                      </div>

                      <!-- <div class="field is-grouped"> -->
                      <div class="control is-expanded">
                        <div class="form-group">
                          <label class="label" for="exampleInputEmail1">Zip</label>
                          <input type="input" class="input form-control" id="zip" placeholder="Zip" maxlength="5"
                            size="5" required>
                        </div>
                      </div>
                    </div>
                    <div class="field">
                      <div class="form-group">
                        <label class="label" for="phone">Phone</label>
                        <input type="tel" id="phone" name="phone" class="input form-control" placeholder="555-555-5555"
                          maxlength="12" size="12" pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}" required>
                      </div>
                    </div>


                    <div class="field">
                      <div class="form-group">
                        <label class="label" for="exampleInputEmail1">Security Question</label>
                        <input type="input" class="input form-control" id="securityQuestion"
                          placeholder="Security Question" required>
                      </div>
                    </div>


                    <div class="field">
                      <div class="form-group">
                        <label class="label" for="exampleInputEmail1">Security Question Answer</label>
                        <input type="input" class="input form-control" id="securityAnswer"
                          placeholder="Security Question Answer" required>
                      </div>
                    </div>

                    <div>
                      <h4 class="title is-4">Are you requesting help for a pet OR volunteering?</h4>
                    </div>
                    <div class="form-group">
                      <input type="radio" id="needHelp" name="needType" value="needHelp">
                      <label for="needHelp">Requesting assistance for my pet</label><br>
                      <input type="radio" id="giveHelp" name="needType" value="giveHelp">
                      <label for="giveHelp">I would like to volunteer</label><br><br>
                    </div>
                    <div id="helpDiv" class="hide">

                      <div class="form-group">
                        <label class="label" for="exampleInputEmail1">Pet Name</label>
                        <input type="input" class="input form-control" id="petName" placeholder="Pet Name" required>
                      </div>
                      <div class="form-group">
                        <div>
                          <br>
                          <button type="button" class="control button button-ikr is-primary" id="upload_widget">Upload
                            Pet
                            Photo</button>
                        </div>
                        <br>
                      </div>
                      <div class="form-group">
                        <label class="label" for="exampleInputEmail1">Breed/Type</label>
                        <input type="input" class="input form-control" id="breed-type" placeholder="Breed/Type"
                          required>
                      </div>
                      <div class="form-group">
                        <label class="label" for="exampleInputEmail1">Pet Age</label>
                        <input type="input" class="input form-control" id="petAge" placeholder="Pet Age" maxlength="3"
                          size="3" required>
                      </div>
                      <div class="form-group">
                        <label class="label" for="petBio">Pet Bio</label>
                        <textarea class="input form-control" id="petBio" placeholder="Pet Bio" maxlength="100"
                          required></textarea>
                      </div>
                      <div class="form-group">
                        <label class="label" for="exampleInputEmail1">Pet Weight</label>
                        <input type="input" class="input form-control" id="petWeight" placeholder="Pet Weight"
                          maxlength="3" size="5" required>
                      </div>
                      <div class="form-group">
                        <label class="label" for="exampleInputEmail1">Reason for Help</label>
                        <textarea class="input form-control" id="helpReason" placeholder="Reason for Help"
                          maxlength="100" required></textarea>
                      </div>
                      <div>
                        <h4 class="title is-4">Are you needing help with pet services or monetary donations?</h4>
                      </div>
                      <div class="form-group">
                        <input type="radio" id="helpTypeService" name="helpType" value="services">
                        <label for="helpTypeService">Pet Services</label><br>
                        <input type="radio" id="helpTypeMonetary" name="helpType" value="monetary">
                        <label for="helpTypeMonetary">Monetary Donation</label><br><br>
                      </div>
                      <div id="monetaryDiv" class="hide">
                        <div class="form-group">
                          <label class="label" for="amountRequested">Amount Requested</label>
                          <input type="input" class="input form-control" id="amountRequested"
                            placeholder="Amount Requested">
                        </div>
                      </div>
                      <div id="servicesDiv" class="hide">
                        <div class="form-group">
                          <label class="label" for="serviceName">Requested Service </label>
                          <input type="input" class="input form-control" id="serviceName"
                            placeholder="Requested Service">
                        </div>

                        <div class="form-group">
                          <label class="label" for="startDate">Start Date</label>
                          <input type="date" id="startDate" name="startDate">
                        </div>

                        <div class="form-group">
                          <label class="label" for="endDate">End Date</label>
                          <input type="date" id="endDate" name="endDate">
                        </div>


                        <div class="form-group">
                          <label class="label" for="exampleInputEmail1">Time of Day</label>
                          <input type="time" class="input form-control" id="timeOfDay" placeholder="Time Of Day">
                        </div>
                        <div class="form-group">
                          <label class="label" for="recurringCheck">Make this a repeating service</label>
                          <input type="checkbox" id="recurringCheck" class="check" name="recurringCheck">
                        </div>

                        <div class="form-group hide" id="frequencyDiv">
                          <label for="frequencySelect">Frequency</label>

                          <select name="frequencySelect" id="frequencySelect">
                            <option value="">Select Frequency:</option>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                          </select>
                        </div>

                        <div id="recurringDiv" class="hide">

                          <div class="form-group">
                            <label for="frequencyNumber">Recur every </label>
                            <input type="input" class="input form-control" id="frequencyNumber"><span id="frequencySpan"
                              style="margin-left:10px;"></span>
                          </div>

                          <div class="form-group">

                            <input type="checkbox" class="input form-control" id="sunday" placeholder="Frequency">
                            <label for="exampleInputEmail1">Sunday</label>
                          </div>
                          <div class="form-group">

                            <input type="checkbox" class="input form-control" id="monday" placeholder="Frequency">
                            <label for="exampleInputEmail1">Monday</label>
                          </div>
                          <div class="form-group">

                            <input type="checkbox" class="input form-control" id="tuesday" placeholder="Frequency">
                            <label for="exampleInputEmail1">Tuesday</label>
                          </div>
                          <div class="form-group">

                            <input type="checkbox" class="input form-control" id="wednesday" placeholder="Frequency">
                            <label for="exampleInputEmail1">Wednesday</label>
                          </div>
                          <div class="form-group">

                            <input type="checkbox" class="input form-control" id="thursday" placeholder="Frequency">
                            <label for="exampleInputEmail1">Thursday</label>
                          </div>
                          <div class="form-group">

                            <input type="checkbox" class="input form-control" id="friday" placeholder="Frequency">
                            <label for="exampleInputEmail1">Friday</label>
                          </div>
                          <div class="form-group">

                            <input type="checkbox" class="input form-control" id="saturday" placeholder="Frequency">
                            <label for="exampleInputEmail1">Saturday</label>
                          </div>

                        </div>

                        <div class="form-group">
                          <label for="serviceNotes">Notes / Additional Information</label>
                          <textarea id="serviceNotes" maxlength="100"></textarea>
                        </div>
                      </div>

                    </div>

                    <div style="display: none" id="alert" class="alert alert-danger" role="alert">
                      <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                      <span class="sr-only">Error:</span> <span class="msg"></span>
                    </div>
                    <br>
                    <br>
                    <button id="signup" type="submit" class="control button button-ikr is-primary">Sign Up</button>
                  </div>
                  <!-- End of registrationDiv -->

              </form>
              <br>
          </div>
        </div>
      </div>
  </div>
  <br>
  <!-- Footer -->
  <section>
    <footer class="footer">
      <div class="container">
        <div class="columns is-desktop">
          <div class="column is-5">
            <h2 class="title is-5"><a class="text-ikr" href="./"><img src="./p2-images/logo/petocracylogo-horizonal.png"
                  width="450"></a></h2>
            <p class="block">We provide an exceptional service when you fall on hard times and are unable to provide
              for your sensational friend. </p>
            <div class="buttons"><a class="button" href="https://www.twitter.com/"><img
                  src="./p2-images/icons/twitter.png" width="25px"></a><a class="button"
                href="https://www.linkedin.com/school/george-washington-university/?trk=public_profile_topcard-school"><img
                  src="./p2-images/icons/linkedin-in.png" width="25px"></a><a class="button"
                href="https://github.com/stithac/group1_project2"><img src="./p2-images/icons/github-brands.png"
                  width="25px"></a></div>
          </div>
          <div class="column">
            <h3 class="title is-6">About Us</h3>
            <ul>
              <li><a class="text-ikr" href="/aboutus#missionstatement">Mission Statement</a></li>
              <li><a class="text-ikr" href="/successfulpets">Success Stories</a></li>
              <li><a class="text-ikr" href="/allvolunteers">Our Volunteers</a></li>
              <li><a class="text-ikr" href="/signup">Join Us</a></li>
            </ul>
          </div>
          <div class="column">
            <h6 class="title is-6">How to Contribute</h6>
            <ul>
              <li><a class="text-ikr" href="/signup">Volunteer</a></li>
              <li><a class="text-ikr" href="/generaldonation">Donate</a></li>
              <li><a class="text-ikr" href="/donatepet">Sponsor</a></li>
              <li><a class="text-ikr" href="/aboutus#contactus">Write a review</a></li>
            </ul>
          </div>
          <div class="column">
            <h6 class="title is-6">Contact</h6>
            <ul>
              <li><a class="text-ikr" href="mailto:info@petocracy.org">info@petocracy.org</a></li>
              <li><a class="text-ikr" href="#">555-555-5555</a></li>
              <li><a class="text-ikr" href="#">555 Honey Crisp Apple Rd</a></li>
            </ul>
          </div>
        </div>
        <hr>
        <div class="columns">
          <div class="column"><a class="text-ikr" href="#">Terms and conditions</a></div>
          <div class="column has-text-right-tablet">
            <p class="subtitle is-6">&copy; 2021 Petocracy. All right reserved.</p>
          </div>
        </div>
      </div>
    </footer>
  </section>
  </div>
  </div>
  <!-- navbar burger code for mobile responsiveness -->
  <script type="text/javascript" src="js/navbarburger.js"></script>
  <!-- <button type="submit" id="submitInfo" class="btn btn-default">Sign Up</button> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

  <!-- external stylesheet with event listeners for buttons/inputs -->
  <script src="js/registration.js" type="text/javascript"></script>

  <script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>

  <script>
    $(document).ready(() => {
      // Getting references to our form and input
      // user fields
      const signUpForm = $("form.signup");
      const firstNameInput = $("input#first-name");
      const lastNameInput = $("input#last-name");
      const streetInput = $("input#street");
      const street2Input = $("input#street2");
      const cityInput = $("input#city");
      const stateInput = $("input#state");
      const zipInput = $("input#zip");
      const phoneInput = $("input#phone");
      const securityQuestionInput = $("input#securityQuestion");
      const securityAnswerInput = $("input#securityAnswer");
      const needTypeInput = $("input#needType");

      // pet fields
      const petNameInput = $("input#petName");
      const breedTypeInput = $("input#breed-type");
      const petAgeInput = $("input#petAge");
      const petWeightInput = $("input#petWeight");
      const petBioInput = $("textarea#petBio");
      const helpReasonInput = $("textarea#helpReason");
      const helpTypeInput = $("input#helpType");

      // monetary fields
      const amountRequestedInput = $("input#amountRequested");

      // services fields
      const serviceNameInput = $("input#serviceName");
      const startDateInput = $("input#startDate");
      const endDateInput = $("input#endDate");
      const recurringCheckInput = $("input#recurringCheck");
      const frequencySelect = $("select#frequencySelect");
      const timeOfDayInput = $("input#timeOfDay");
      const frequencyNumberInput = $("input#frequencyNumber");
      const sundayInput = $("input#sunday");
      const mondayInput = $("input#monday");
      const tuesdayInput = $("input#tuesday");
      const wednesdayInput = $("input#wednesday");
      const thursdayInput = $("input#thursday");
      const fridayInput = $("input#friday");
      const saturdayInput = $("input#saturday");
      const notesInput = $("textarea#serviceNotes");

      // additional global variables
      var picURLInput;
      var savedEmail;
      var savedID;

      //******************************************************************/

      signUpForm.on("submit", event => {

        event.preventDefault();

        const regData = {
          firstName: firstNameInput.val().trim(),
          lastName: lastNameInput.val().trim(),
          street: streetInput.val().trim(),
          street2: street2Input.val().trim(),
          city: cityInput.val().trim(),
          state: stateInput.val().trim(),
          zip: zipInput.val().trim(),
          phone: phoneInput.val().trim(),
          securityQuestion: securityQuestionInput.val().trim(),
          securityAnswer: securityAnswerInput.val().trim(),
          help_volunteer: $("input[name='needType']:checked").val(),

          petName: petNameInput.val().trim(),
          breed_type: breedTypeInput.val().trim(),
          petAge: petAgeInput.val().trim(),
          petWeight: petWeightInput.val(),
          petBio: petBioInput.val().trim(),
          helpReason: helpReasonInput.val(),
          services_monetary: $("input[name='helpType']:checked").val(),

          amountRequested: amountRequestedInput.val().trim(),

          serviceName: serviceNameInput.val().trim(),
          startDate: startDateInput.val().trim(),
          endDate: endDateInput.val().trim(),
          recurring: recurringCheckInput.prop("checked"),
          frequency: frequencySelect.val(),
          timeOfDay: timeOfDayInput.val(),
          recurringNumber: frequencyNumberInput.val(),
          sunday: sundayInput.prop("checked"),
          monday: mondayInput.prop("checked"),
          tuesday: tuesdayInput.prop("checked"),
          wednesday: wednesdayInput.prop("checked"),
          thursday: thursdayInput.prop("checked"),
          friday: fridayInput.prop("checked"),
          saturday: saturdayInput.prop("checked"),
          notes: notesInput.val().trim(),

          picURL: picURLInput
        };
        regData.timeOfDay = calcDay(regData.timeOfDay);

        regUser(regData)

      });

      // function to add :SS to timeOfDay field to match format mySQL requires for TIME field type 

      function calcDay(timeOfDay) {
        var newTime = timeOfDay;
        newTime = newTime + ":00";
        return newTime;
      }

      // Does a post to the signup route. If successful, we are redirected to the userLanding page
      // Otherwise we log any errors
      function regUser(postRegData) {
        fetch('/api/user_data', {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json',
            },
          })
          .then((response) => response.json())
          .then((data) => {
            savedEmail = data.email;
            savedID = data.id;
            $.post("/api/register", {
                email: data.email,
                firstName: postRegData.firstName,
                lastName: postRegData.lastName,
                street: postRegData.street,
                street2: postRegData.street2,
                city: postRegData.city,
                state: postRegData.state,
                zip: postRegData.zip,
                phone: postRegData.phone,
                question: postRegData.securityQuestion,
                answer: postRegData.securityAnswer,
                help_volunteer: postRegData.help_volunteer
              })
              .then(() => {
                if (postRegData.help_volunteer === "giveHelp") {
                  window.location.replace("/userLanding");
                } else {
                  fetch('/api/user_data', {
                      method: 'GET',
                      headers: {
                        'Content-Type': 'application/json',
                      },
                    })
                    .then((response) => response.json())
                    .then((data) => {
                      $.post("/api/registerPet", {
                          registrationId: data.id,
                          petName: postRegData.petName,
                          breed_type: postRegData.breed_type,
                          petAge: postRegData.petAge,
                          petWeight: postRegData.petWeight,
                          petBio: postRegData.petBio,
                          helpReason: postRegData.helpReason,
                          amountRequested: postRegData.amountRequested,
                          services_monetary: postRegData.services_monetary,
                          picURL: postRegData.picURL
                        })
                        .then(() => {
                          if (postRegData.services_monetary === "monetary") {
                            window.location.replace("/userLanding");
                          } else {
                            fetch('/api/user_data', {
                                method: 'GET',
                                headers: {
                                  'Content-Type': 'application/json',
                                },
                              })
                              .then((response) => response.json())
                              .then((data) => {
                                $.post("/api/registerService", {
                                    registrationId: data.id,
                                    serviceName: postRegData.serviceName,
                                    startDate: postRegData.startDate,
                                    endDate: postRegData.endDate,
                                    recurring: postRegData.recurring,
                                    frequency: postRegData.frequency,
                                    timeOfDay: postRegData.timeOfDay,
                                    recurringNumber: postRegData.recurringNumber,
                                    sunday: postRegData.sunday,
                                    monday: postRegData.monday,
                                    tuesday: postRegData.tuesday,
                                    wednesday: postRegData.wednesday,
                                    thursday: postRegData.thursday,
                                    friday: postRegData.friday,
                                    saturday: postRegData.saturday,
                                    notes: postRegData.notes
                                  })
                                  .then(() => {
                                    window.location.replace("/userLanding");
                                    // If there's an error, handle it by throwing up a bootstrap alert
                                  })
                                  .catch(handleLoginErr);
                              })
                          }
                          // If there's an error, handle it by throwing up a bootstrap alert
                        })
                        .catch(handleLoginErr);
                    })
                }
              })
              .catch(handleLoginErr);
          })
      }

      function handleLoginErr(err) {
        $("#alert .msg").text(err.responseJSON);
        $("#alert").fadeIn(500);
      }

      document.getElementById("upload_widget").addEventListener("click", function () {

        fetch('/api/envVars', {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json',
            },
          })
          .then((response) => response.json())
          .then((data) => {

            cloudinary.openUploadWidget({
              cloudName: data.cloudName,
              uploadPreset: data.uploadPreset,
              sources: [
                "local"
              ],
              googleApiKey: "<image_search_google_api_key>",
              showAdvancedOptions: true,
              cropping: true,
              multiple: false,
              defaultSource: "local",
              styles: {
                palette: {
                  window: "#F5F5F5",
                  sourceBg: "#438945",
                  windowBorder: "#F7F4E9",
                  tabIcon: "#438945",
                  inactiveTabIcon: "#E8D5BB",
                  menuIcons: "#B59B4D",
                  link: "#F7F4E9",
                  action: "#F7F4E9",
                  inProgress: "#99cccc",
                  complete: "#78b3b4",
                  error: "#F5F5F5",
                  textDark: "#1B1918",
                  textLight: "#695A5A"
                },
                fonts: {
                  default: null,
                  "'Kalam', cursive": {
                    url: "https://fonts.googleapis.com/css?family=Kalam",
                    active: true
                  }
                }
              }
            }, (error, result) => {
              if (!error) {
                if (result.event === "success") {
                  picURLInput = result.info.url;
                };
              };
            });
          })
          .catch((err) => console.error(err))
      });
    })
  </script>
</body>

</html>