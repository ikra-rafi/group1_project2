<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
</head>


<body>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
      </div>
    </div>
  </nav>
  <div class="container">
    <div class="row">
      <div class="col-md-6 col-md-offset-3">
        <h2>Sign Up Form</h2>
        <form class="signup">
          <div class="form-group">
            <label for="exampleInputEmail1">First Name</label>
            <input type="input" class="form-control" id="first-name" placeholder="First Name" required>
          </div>
          <div class="form-group">
            <label for="exampleInputEmail1">Last Name</label>
            <input type="input" class="form-control" id="last-name" placeholder="Last Name" required>
          </div>
          <div class="form-group">
            <label for="exampleInputEmail1">Street</label>
            <input type="input" class="form-control" id="street" placeholder="Street" required>
          </div>
          <div class="form-group">
            <label for="exampleInputEmail1">City</label>
            <input type="input" class="form-control" id="city" placeholder="City" required>
          </div>
          <div class="form-group">
            <label for="exampleInputEmail1">State</label>
            <input type="input" class="form-control" id="state" placeholder="State" required>
          </div>
          <div class="form-group">
            <label for="exampleInputEmail1">Zip</label>
            <input type="input" class="form-control" id="zip" placeholder="Zip" required>
          </div>
          <div class="form-group">
            <label for="phone">Phone</label>
            <input type="tel" id="phone" name="phone" class="form-control" placeholder="123-45-6789"
              pattern="[0-9]{3}-[0-9]{2}-[0-9]{4}" required>
          </div>
          <div class="form-group">
            <label for="exampleInputEmail1">Security Question</label>
            <input type="input" class="form-control" id="securityQuestion" placeholder="Security Question" required>
          </div>
          <div class="form-group">
            <label for="exampleInputEmail1">Security Question Answer</label>
            <input type="input" class="form-control" id="securityAnswer" placeholder="Security Question Answer"
              required>
          </div>
          <div>
            <p>Are you requesting help for a pet OR volunteering?</p>
          </div>
          <div class="form-group">
            <input type="radio" id="requestHelp" name="petHelp" value="1">
            <label for="petHelp">Request Help</label><br>
            <input type="radio" id="volunteer" name="petHelp" value="2">
            <label for="volunteer">Volunteer</label>
          </div>
          <br>
          <div class="form-group" id="petName1">
            <label for="exampleInputEmail1">Pet Name</label>
            <input type="input" class="form-control" id="petName" name="petHelp" placeholder="Pet Name" required>
          </div>
          <p>You can upload a photo of your pet below:</p>
          <button id="upload_widget" class="cloudinary-button">Upload Pet Photo</button>
          <br><br>
          <div class="form-group" id="petName1">
            <label for="exampleInputEmail1">Breed/Type</label>
            <input type="input" class="form-control" id="breed-type" name="petHelp" placeholder="Breed/Type" required>
          </div>
          <div class="form-group" id="petName1">
            <label for="exampleInputEmail1">Pet Age</label>
            <input type="input" class="form-control" id="petAge" name="petHelp" placeholder="Pet Age" required>
          </div>
          <div class="form-group" id="petName1">
            <label for="exampleInputEmail1">Pet Bio</label>
            <input type="input" class="form-control" id="petBio" name="petHelp" placeholder="Pet Bio" required>
          </div>
          <div class="form-group" id="petName1">
            <label for="exampleInputEmail1">Pet Weight</label>
            <input type="input" class="form-control" id="petWeight" name="petHelp" placeholder="Pet Weight" required>
          </div>
          <div class="form-group" id="petName1">
            <label for="exampleInputEmail1">Reason for Help</label>
            <input type="input" class="form-control" id="helpReason" name="petHelp" placeholder="Reason for Help">
          </div>
          <div>
            <p>Are you needing help with pet services or monetary donations?</p>
          </div>
          <div class="form-group">
            <input type="radio" id="petServices" name="help">
            <label for="petServices">Pet Services</label><br>
            <input type="radio" id="monetaryDonation" name="help">
            <label for="monetaryDonation">Monetary Donation</label>
          </div>
          <br>
          <div class="form-group">
            <label for="exampleInputEmail1">Amount Requested</label>
            <input type="input" class="form-control" id="amountRequested" placeholder="Amount Requested" required>
          </div>
          <div class="form-group">
            <label for="exampleInputEmail1">Service Name</label>
            <input type="input" class="form-control" id="serviceName" placeholder="serviceName" required>
          </div>
          <div class="form-group">
            <label for="exampleInputEmail1">Frequency</label>
            <input type="input" class="form-control" id="frequency" placeholder="Frequency">
          </div>
<!--           <div class="form-group">
            <label for="exampleInputEmail1">Time of Day</label>
            <input type="input" class="form-control" id="timeOfDay" placeholder="Time Of Day">
          </div> -->
          <div class="form-group">
            <label for="appt">Select a time:</label>
            <input type="time" id="timeOfDay" name="timeOfDay">
          </div>
          <div class="form-group">
            <label for="exampleInputEmail1">Day of Week</label>
            <input type="input" class="form-control" id="dayOfWeek" placeholder="Day of Week">
          </div>
          <div class="form-group">
            <label for="exampleInputEmail1">Monday</label>
            <input type="checkbox" class="form-control" id="monday" placeholder="Frequency">
          </div>
          <div class="form-group">
            <label for="exampleInputEmail1">Tuesday</label>
            <input type="checkbox" class="form-control" id="tuesday" placeholder="Frequency">
          </div>
          <div class="form-group">
            <label for="exampleInputEmail1">Wednesday</label>
            <input type="checkbox" class="form-control" id="wednesday" placeholder="Frequency">
          </div>
          <div class="form-group">
            <label for="exampleInputEmail1">Thursday</label>
            <input type="checkbox" class="form-control" id="thursday" placeholder="Frequency">
          </div>
          <div class="form-group">
            <label for="exampleInputEmail1">Friday</label>
            <input type="checkbox" class="form-control" id="friday" placeholder="Frequency">
          </div>
          <div class="form-group">
            <label for="exampleInputEmail1">Saturday</label>
            <input type="checkbox" class="form-control" id="saturday" placeholder="Frequency">
          </div>
          <div class="form-group">
            <label for="exampleInputEmail1">Sunday</label>
            <input type="checkbox" class="form-control" id="sunday" placeholder="Frequency">
          </div>
          <div style="display: none" id="alert" class="alert alert-danger" role="alert">
            <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
            <span class="sr-only">Error:</span> <span class="msg"></span>
          </div>
          <br>
          <br>
        </form>
        <br>
      </div>
    </div>
  </div>
  <br>
  <button type="submit" id="submitInfo" class="btn btn-default">Sign Up</button>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <div>

  </div>

  <script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>

  <script>
    $(document).ready(() => {
      // Getting references to our form and input
      const signUpForm = $("#submitInfo");
      const firstNameInput = $("input#first-name");
      const lastNameInput = $("input#last-name");
      const streetInput = $("input#street");
      const cityInput = $("input#city");
      const stateInput = $("input#state");
      const zipInput = $("input#zip");
      const phoneInput = $("input#phone");
      const petNameInput = $("input#petName");
      const breedTypeInput = $("input#breed-type");
      const petAgeInput = $("input#petAge");
      const petWeightInput = $("input#petWeight");
      const petBioInput = $("input#petBio");
      const helpReasonInput = $("input#helpReason");
      const amountRequestedInput = $("input#amountRequested");
      const securityQuestionInput = $("input#securityQuestion");
      const securityAnswerInput = $("input#securityAnswer");
      const serviceNameInput = $("input#serviceName");
      const frequencyInput = $("input#frequency");
      const dayOfWeekInput = $("input#dayOfWeek");
      const mondayInput = $("input#monday");
      const tuesdayInput = $("input#tuesday");
      const wednesdayInput = $("input#wednesday");
      const thursdayInput = $("input#thursday");
      const fridayInput = $("input#friday");
      const saturdayInput = $("input#saturday");
      const sundayInput = $("input#sunday");
      const timeOfDayInput = $("input#timeOfDay");
      var picURLInput;
      var savedEmail;
      var savedID;
      var petHelp;

      if(document.getElementById('requestHelp').checked) {
      //Need pet help radio button is checked
        petHelp = true;
      } else if(document.getElementById('volunteer').checked) {
        //volunteer radio button is checked
        petHelp = false;
      }
      $('input[name="petHelp"]').on('change', function () {
            // this, in the anonymous function, refers to the changed-<input>:
            // select the element(s) you want to show/hide:
            $('#petName1')
                // pass a Boolean to the method, if the numeric-value of the changed-<input>
                // is exactly equal to 2 and that <input> is checked, the .business-fields
                // will be shown:
                .toggle(+this.value === 2 && this.checked);
            if (+this.value === 1) {
                $('#petName').removeAttr('required');
            } else if (+this.value === 2) {
                $('#petName').attr('required', '');
            }
            // trigger the change event, to show/hide the .business-fields element(s) on
            // page-load:
        }).change();

//      var currentValue = 0;
//function handleClick(myRadio) {
//    alert('Old value: ' + currentValue);
 //   alert('New value: ' + myRadio.value);
//    currentValue = myRadio.value;
//}
$('#petHelp').hide();

$("#petHelp").change(function() {
  if ($(this).checked = true) {
    $('#petName').show();
    $('#petName').attr('required', '');
    $('#petName').attr('data-error', 'This field is required.');
  } else {
    $('#petName').hide();
    $('#petName').removeAttr('required');
    $('#petName').removeAttr('data-error');
  }
});
$("#petHelp").trigger("onchange");

      //      signUpForm.on("submit", event => {
      $("#submitInfo").on("click", function () {
        event.preventDefault();
        console.log(petWeightInput.val());
        const regData = {
          firstName: firstNameInput.val().trim(),
          lastName: lastNameInput.val().trim(),
          street: streetInput.val().trim(),
          city: cityInput.val().trim(),
          state: stateInput.val().trim(),
          zip: zipInput.val().trim(),
          phone: phoneInput.val().trim(),
          petName: petNameInput.val().trim(),
          breed_type: breedTypeInput.val().trim(),
          petAge: petAgeInput.val().trim(),
          petWeight: petWeightInput.val().trim(),
          petBio: petBioInput.val().trim(),
          helpReason: helpReasonInput.val().trim(),
          amountRequested: amountRequestedInput.val().trim(),
          securityQuestion: securityQuestionInput.val().trim(),
          securityAnswer: securityAnswerInput.val().trim(),
          serviceName: serviceNameInput.val().trim(),
          frequency: frequencyInput.val().trim(),
          monday: mondayInput.val(),
          tuesday: tuesdayInput.val(),
          wednesday: wednesdayInput.val(),
          thursday: thursdayInput.val(),
          friday: fridayInput.val(),
          saturday: saturdayInput.val(),
          sunday: sundayInput.val(),
          picURL: picURLInput
        };

        regUser(regData.firstName, regData.lastName, regData.street, regData.city, regData.state,
          regData.zip, regData.phone, regData.securityQuestion, regData.securityAnswer);
        regPet(regData.petName, regData.breed_type, regData.petAge, regData.petWeight, regData.petBio, regData
          .helpReason, regData.amountRequested, regData.picURL);
        //        regService(regData.serviceName, regData.frequency, regData.monday, regData.tuesday, regData.wednesday, regData.thursday, regData.friday, regData.saturday, regData.sunday)
        firstNameInput.val("");
        lastNameInput.val("");
        streetInput.val("");
        cityInput.val("");
        stateInput.val("");
        zipInput.val("");
        phoneInput.val("");
        petNameInput.val("");
        breedTypeInput.val("");
        petAgeInput.val("");
        petWeightInput.val("");
        petBioInput.val("");
        helpReasonInput.val("");
        amountRequestedInput.val("");
        securityQuestionInput.val("");
        securityAnswerInput.val("");
      });

      // Does a post to the signup route. If successful, we are redirected to the members page
      // Otherwise we log any errors
      function regUser(firstName, lastName, street, city, state, zip, phone, question, answer) {
        fetch('/api/user_data', {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json',
            },
          })
          .then((response) => response.json())
          .then((data) => {
            savedEmail = data.email;
            savedID = data.id;
            console.log(firstName, lastName, street, city, state, zip, phone, question, answer);
            $.post("/api/register", {
                email: data.email,
                firstName: firstName,
                lastName: lastName,
                street: street,
                city: city,
                state: state,
                zip: zip,
                phone: phone,
                question: question,
                answer: answer,
              })
              .then(() => {
                console.log("did I return successfully from api/register");
                //                window.location.replace("/members");
                // If there's an error, handle it by throwing up a bootstrap alert
              })
              .catch(handleLoginErr);
          })
      }

      function regPet(petName, breed_type, petAge, petWeight, petBio, helpReason, amountRequested, picURL) {
        fetch('/api/user_data', {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json',
            },
          })
          .then((response) => response.json())
          .then((data) => {
            console.log(petName, breed_type, petAge, petWeight, petBio, helpReason, amountRequested, picURL);
            $.post("/api/registerPet", {
                registrationId: data.id,
                petName: petName,
                breed_type: breed_type,
                petAge: petAge,
                petWeight: petWeight,
                petBio: petBio,
                helpReason: helpReason,
                amountRequested: amountRequested,
                picURL: picURL
              })
              .then(() => {
                console.log("did I return successfully from api/registePet");
                //                window.location.replace("/members");
                // If there's an error, handle it by throwing up a bootstrap alert
              })
              .catch(handleLoginErr);
          })
      }

      function handleLoginErr(err) {
        $("#alert .msg").text(err.responseJSON);
        $("#alert").fadeIn(500);
      }

      document.getElementById("upload_widget").addEventListener("click", function () {

        fetch('/api/envVars', {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json',
            },
          })
          .then((response) => response.json())
          .then((data) => {
            console.log('successful GET', data);

            cloudinary.openUploadWidget({
              cloudName: data.cloudName,
              uploadPreset: data.uploadPreset,
              sources: [
                "local"
              ],
              googleApiKey: "<image_search_google_api_key>",
              showAdvancedOptions: true,
              cropping: true,
              multiple: false,
              defaultSource: "local",
              styles: {
                palette: {
                  window: "#5D005D",
                  sourceBg: "#3A0A3A",
                  windowBorder: "#AD5BA3",
                  tabIcon: "#ffffcc",
                  inactiveTabIcon: "#FFD1D1",
                  menuIcons: "#FFD1D1",
                  link: "#ffcc33",
                  action: "#ffcc33",
                  inProgress: "#00e6b3",
                  complete: "#a6ff6f",
                  error: "#ff1765",
                  textDark: "#3c0d68",
                  textLight: "#fcfffd"
                },
                fonts: {
                  default: null,
                  "'Kalam', cursive": {
                    url: "https://fonts.googleapis.com/css?family=Kalam",
                    active: true
                  }
                }
              }
            }, (error, result) => {
              if (!error) {
                console.log("Upload Widget event - ", result);
                if (result.event === "success") {
                  picURLInput = result.info.url;
                  console.log(result.info.url);
                };
              };
            });
          })
          .catch((err) => console.error(err))
      });
    });
  </script>
</body>

</html>